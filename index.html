<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>è–¬å‰¤è²»ç”¨è¨ˆç®—ã‚¢ãƒ—ãƒª v2.3ï¼ˆç°¡æ˜“ï¼‹è©³ç´°åŒæ™‚è¡¨ç¤ºï¼‰</title>
<style>
:root{ --gap:14px; --fz:18px; --pad:14px; --btnh:50px; }
@media (min-width:768px){ :root{ --fz:16px; --pad:10px; --btnh:44px; } }
*{box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;margin:0;padding:16px;font-size:var(--fz);-webkit-text-size-adjust:100%;background:#fafafa}
h1{font-size:calc(var(--fz) + 2px);margin:0 0 8px 0}
.row{display:flex;gap:var(--gap);flex-wrap:wrap;align-items:center}
.col{flex:1 1 210px;min-width:210px}
input,select,button,textarea{width:100%;font-size:var(--fz);padding:var(--pad);min-height:var(--btnh);border-radius:12px;border:1px solid #d0d0d0;background:#fff}
button{background:#0a84ff;color:#fff;border:0;cursor:pointer}
button.secondary{background:#f2f2f7;color:#111;border:1px solid #d0d0d0}
textarea{height:140px}
.card{border:1px solid #e5e5ea;border-radius:14px;padding:14px;margin:14px 0;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.04)}
</style>
</head>
<body>
<h1>è–¬å‰¤è²»ç”¨è¨ˆç®—ã‚¢ãƒ—ãƒª v2.3ï¼ˆç°¡æ˜“ï¼‹è©³ç´°åŒæ™‚è¡¨ç¤ºï¼‰</h1>

<div class="card">
  <div class="row">
    <div class="col"><label>ä½“é‡ï¼ˆkgï¼‰</label><input type="number" id="weight" step="0.01"/></div>
    <div class="col"><label>æ—¥æ•°</label><input type="number" id="days" value="7" min="1"/></div>
    <div class="col"><label>å›æ•°/æ—¥</label>
      <select id="timesPerDay"><option value="1">SID</option><option value="2" selected>BID</option><option value="3">TID</option></select>
    </div>
  </div>
</div>

<div class="card">
  <button id="calcBtn">è¨ˆç®—ã™ã‚‹</button>
</div>

<div class="card">
  <h3>ğŸ“‹ ã‚«ãƒ«ãƒ†è²¼ä»˜ç”¨ï¼ˆç°¡æ˜“ï¼‰</h3>
  <textarea id="outputSimple" readonly></textarea>
  <button onclick="copyText('outputSimple')">ã‚³ãƒ”ãƒ¼</button>
</div>

<div class="card">
  <h3>ğŸ§® è¨ˆç®—æ ¹æ‹ ï¼ˆè©³ç´°ï¼‰</h3>
  <textarea id="outputDetail" readonly></textarea>
  <button onclick="copyText('outputDetail')">ã‚³ãƒ”ãƒ¼</button>
</div>

<script>
function ceil10(y){return Math.ceil(y/10)*10}
function ceilYen(y){return Math.ceil(y)}

function copyText(id){
  const ta=document.getElementById(id);
  ta.select();document.execCommand("copy");
  alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
}

document.getElementById("calcBtn").addEventListener("click",()=>{
  const w=parseFloat(document.getElementById("weight").value||0);
  const d=parseInt(document.getElementById("days").value||0);
  const tpd=parseInt(document.getElementById("timesPerDay").value||0);
  
  if(!w||!d||!tpd){alert("ä½“é‡ãƒ»æ—¥æ•°ãƒ»å›æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");return;}
  
  // â˜…ã“ã“ã§ã¯ãƒ‡ãƒ¢ã¨ã—ã¦2å‰¤å›ºå®šã€‚å®Ÿéš›ã¯CSVã‹ã‚‰èª­ã‚“ã è–¬å‰¤ãƒªã‚¹ãƒˆã‚’ä½¿ã†
  const drugs=[
    {name:"ãƒˆãƒ©ãƒ³ã‚µãƒŸãƒ³",unit:250,dose:10,form:"éŒ å‰¤",cost:30},
    {name:"ãƒ¡ãƒˆãƒ­ãƒ‹ãƒ€ã‚¾ãƒ¼ãƒ«",unit:250,dose:10,form:"éŒ å‰¤",cost:20}
  ];
  
  let simpleList=[], detailList=[];
  let total=0;
  
  drugs.forEach(dr=>{
    const mgPerDose=w*dr.dose;
    const totalMg=mgPerDose*tpd*d;
    const count=Math.ceil(totalMg/dr.unit);
    const unitPrice=ceil10(dr.cost*2);
    const drugCost=ceilYen(unitPrice*count);
    total+=drugCost;
    
    // ç°¡æ˜“å‡ºåŠ›ç”¨
    if(dr.form==="éŒ å‰¤"){
      simpleList.push(`${dr.name}${dr.unit}mg ${count}t`);
    }
    
    // è©³ç´°å‡ºåŠ›ç”¨
    detailList.push(`ã€${dr.form}ã€‘${dr.name} ${dr.unit}mg/${dr.form==="éŒ å‰¤"?"éŒ ":"mL"}
${dr.dose}mg/kg Ã— ${tpd}å› Ã— ${d}æ—¥åˆ†ï¼ˆä½“é‡ï¼š${w}kgï¼‰
â†’ å¿…è¦é‡ï¼š${Math.round(totalMg)}mgï¼ˆ${count}${dr.form==="éŒ å‰¤"?"éŒ ":"mL"}ï¼‰

è–¬å‰¤æ–™ï¼š${drugCost}å††ï¼ˆ${unitPrice}å††/${dr.form==="éŒ å‰¤"?"éŒ ":"mL"} Ã— ${count}${dr.form==="éŒ å‰¤"?"éŒ ":"mL"}ï¼‰
`);
  });
  
  const scriptFee=(80+40*(drugs.length-1))*d;
  total+=scriptFee;
  
  // ç°¡æ˜“ãƒ¢ãƒ¼ãƒ‰å‡ºåŠ›
  const simple=`å†…æœè–¬ï¼ ${80+40*(drugs.length-1)} x${d}
${simpleList.join("  ")}
ç²‰ ${tpd*d}åˆ†åŒ… BID ${d}æ—¥åˆ†
ã‚·ãƒ­ãƒƒãƒ— ${tpd*d}mL BID ${d}æ—¥åˆ†`;
  document.getElementById("outputSimple").value=simple;
  
  // è©³ç´°å‡ºåŠ›
  let detail=detailList.join("\n")+"\nå‡¦æ–¹æ–™ï¼š"+scriptFee+"å††\nâ€”â€”â€”\nåˆè¨ˆï¼š"+total+"å††";
  document.getElementById("outputDetail").value=detail;
});
</script>
</body>
</html>
