<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>è–¬å‰¤è²»ç”¨è¨ˆç®— v6.7 - å®‰å…¨æ€§å¼·åŒ–ç‰ˆ</title>
    <style>
        :root {
            --primary: #0a84ff;
            --danger: #d70015;
            --warning: #ff9500;
            --success: #34c759;
            --bg: #f5f5f7;
            --card: #ffffff;
            --border: #e5e5ea;
            --text: #333333;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            margin: 0;
            padding: 0;
            color: var(--text);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            margin: 0;
            font-size: 28px;
            color: var(--primary);
        }

        .header .version {
            font-size: 12px;
            color: var(--success);
            margin-top: 5px;
        }

        .layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1024px) {
            .layout {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .card h2 {
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 18px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input {
            width: auto;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            width: 100%;
            margin-top: 10px;
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 12px;
            background: var(--danger);
            color: white;
        }

        .btn-small:hover {
            opacity: 0.9;
        }

        .btn-add {
            padding: 12px;
            background: var(--bg);
            color: var(--primary);
            font-weight: 600;
            border: 2px dashed var(--primary);
            margin-top: 10px;
        }

        .btn-add:hover {
            background: var(--primary);
            color: white;
        }

        .alert {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 13px;
            line-height: 1.5;
        }

        .alert-danger {
            background: #fee;
            border-left: 4px solid var(--danger);
            color: #c41e3a;
        }

        .alert-warning {
            background: #fef3cd;
            border-left: 4px solid var(--warning);
            color: #856404;
        }

        .alert-success {
            background: #d4edda;
            border-left: 4px solid var(--success);
            color: #155724;
        }

        .alert-info {
            background: #cfe2ff;
            border-left: 4px solid var(--primary);
            color: #084298;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .result-table th {
            background: var(--bg);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--border);
        }

        .result-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
        }

        .result-table tr:hover {
            background: var(--bg);
        }

        .result-box {
            background: var(--bg);
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }

        .calculation-basis {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid var(--primary);
            font-size: 13px;
            line-height: 1.8;
            margin: 15px 0;
        }

        .calculation-basis h4 {
            margin-top: 0;
            color: var(--primary);
        }

        .calculation-basis p {
            margin: 6px 0;
        }

        .danger-highlight {
            background: #ffebee;
            border: 2px solid var(--danger);
            color: var(--danger);
            padding: 10px;
            border-radius: 6px;
            font-weight: 600;
        }

        .copy-btn {
            padding: 10px 15px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            margin-top: 10px;
        }

        .copy-btn:hover {
            opacity: 0.9;
        }

        .hidden {
            display: none;
        }

        .pill {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 5px;
        }

        .pills-danger {
            background: var(--danger);
        }

        .pills-warning {
            background: var(--warning);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ è–¬å‰¤è²»ç”¨è¨ˆç®—</h1>
            <div class="version">v6.7 - å®‰å…¨æ€§å¼·åŒ–ç‰ˆ (æŠ•ä¸é‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ä»˜ã)</div>
        </div>

        <div id="globalAlerts"></div>

        <div class="layout">
            <!-- å·¦ã‚«ãƒ©ãƒ : å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
            <div>
                <div class="card">
                    <h2>ğŸ“‹ åŸºæœ¬è¨­å®š</h2>
                    
                    <div class="form-group">
                        <label>ä½“é‡ (kg) *</label>
                        <input type="number" id="weight" placeholder="5.0" step="0.1" min="0.1" max="500">
                    </div>

                    <div class="form-group">
                        <label>æŠ•ä¸æ—¥æ•° (æ—¥) *</label>
                        <input type="number" id="days" placeholder="7" min="1" max="365">
                    </div>

                    <div class="form-group">
                        <label>1æ—¥æŠ•ä¸å›æ•°</label>
                        <select id="frequency">
                            <option value="1">1å›/æ—¥ (BID)</option>
                            <option value="2" selected>2å›/æ—¥ (BID)</option>
                            <option value="3">3å›/æ—¥ (TID)</option>
                            <option value="4">4å›/æ—¥ (QID)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>å‡¦æ–¹å½¢æ…‹</label>
                        <select id="formulation">
                            <option value="liquid">æ¶²å‰¤ (TAB)</option>
                            <option value="tablet">éŒ å‰¤ (TAB)</option>
                            <option value="injection">æ³¨å°„å‰¤ (INJ)</option>
                        </select>
                    </div>

                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="hasDietCost" checked>
                        <label for="hasDietCost" style="margin-bottom: 0;">åˆ†åŒ…æ©Ÿæ¢°ä½¿ç”¨ (+20å††/å›)</label>
                    </div>

                    <hr>

                    <div class="card" style="background: var(--bg); padding: 15px; margin: 0 -20px -20px -20px; border-radius: 0 0 12px 12px;">
                        <h3 style="margin-top: 0;">è–¬å‰¤å…¥åŠ› (Enterã‚­ãƒ¼ã§ç¢ºå®š)</h3>
                        <div id="drugInput" class="drug-input-row">
                            <div style="display: grid; grid-template-columns: 1fr 0.5fr 0.7fr 0.8fr auto; gap: 8px; align-items: end;">
                                <input type="text" id="drugName" placeholder="è–¬å‰¤å" autocomplete="off" list="drugList">
                                <input type="number" id="drugDose" placeholder="ç”¨é‡" step="0.1">
                                <input type="text" id="drugUnit" placeholder="å˜ä½" value="mg/kg">
                                <input type="number" id="drugPrice" placeholder="ä¾¡æ ¼" step="1">
                                <button class="btn-small" onclick="addDrugRow()">âœ•</button>
                            </div>
                        </div>

                        <datalist id="drugList">
                            <!-- è–¬å‰¤ä¸€è¦§ã¯åˆ¥é€”èª­ã¿è¾¼ã¿ -->
                        </datalist>

                        <button class="btn-add" onclick="addNewDrugRow()">+ è–¬å‰¤ã‚’è¿½åŠ </button>
                        <button class="btn-primary" onclick="calculateAll()">ğŸ“Š è¨ˆç®—å®Ÿè¡Œ</button>
                    </div>

                    <div style="margin-top: 15px;">
                        <label>è–¬å‰¤CSVã‚’ãƒ‰ãƒ­ãƒƒãƒ—</label>
                        <div id="dropZone" style="border: 2px dashed var(--border); border-radius: 6px; padding: 30px; text-align: center; cursor: pointer; background: var(--bg);">
                            ğŸ“ è–¬å‰¤CSVã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ã‚«ãƒ©ãƒ : çµæœè¡¨ç¤º -->
            <div>
                <div class="card">
                    <h2>ğŸ“ˆ è¨ˆç®—çµæœ</h2>
                    <div id="resultArea">
                        <p style="color: #999; text-align: center;">è¨ˆç®—çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h2>ğŸ” å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯</h2>
                    <div id="safetyAlerts">
                        <p style="color: #999;">å…¥åŠ›å€¤ã«åŸºã¥ã„ãŸè­¦å‘ŠãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =========================================
        // Phase 1: å¼·åŒ–ç‰ˆè–¬å‰¤ãƒã‚¹ã‚¿ãƒ¼ï¼ˆåŒ»å­¦çš„å®‰å…¨æƒ…å ±ä»˜ãï¼‰
        // =========================================
        const DRUG_MASTER = {
            "ã‚¢ãƒ¢ã‚­ã‚·ã‚·ãƒªãƒ³": {
                concentration: 250,
                unit: "mg/kg",
                dosage_min: 15,
                dosage_max: 25,
                max_total_per_dose: 1000,
                contraindications: ["ãƒšãƒ‹ã‚·ãƒªãƒ³ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼"],
                warnings: ["è‚æ©Ÿèƒ½ä½ä¸‹æ™‚ã¯è¦æ³¨æ„", "è…æ©Ÿèƒ½ä½ä¸‹æ™‚ã¯ç”¨é‡50%æ¸›"],
                notes: "ãƒšãƒ‹ã‚·ãƒªãƒ³ç³»æŠ—ç”Ÿç‰©è³ª"
            },
            "ã‚»ãƒ•ã‚©ã‚¿ãƒƒã‚¯ã‚¹": {
                concentration: 100,
                unit: "mg/kg",
                dosage_min: 20,
                dosage_max: 40,
                max_total_per_dose: 2000,
                contraindications: [],
                warnings: ["è…æ©Ÿèƒ½ä½ä¸‹æ™‚ã¯ç”¨é‡èª¿æ•´ãŒå¿…è¦"],
                notes: "ç¬¬3ä¸–ä»£ã‚»ãƒ•ã‚©ãƒ­ã‚¹ãƒãƒªãƒ³"
            },
            "ãƒ—ãƒ­ãƒ”ã‚ªãƒã‚¸ãƒ³": {
                concentration: 10,
                unit: "mg/kg",
                dosage_min: 0.1,
                dosage_max: 0.2,
                max_total_per_dose: 10,
                contraindications: ["ã‚·ãƒ§ãƒƒã‚¯çŠ¶æ…‹", "é‡åº¦ã®ä½è¡€åœ§"],
                warnings: ["é®é™ä½œç”¨ãŒå¼·ã„"],
                notes: "ãƒ•ã‚§ãƒãƒã‚¢ã‚¸ãƒ³ç³»é®é™è–¬"
            }
            // ä»–ã®173ç¨®ã¯ã“ã“ã«è¿½åŠ 
        };

        // =========================================
        // Phase 1: å…¥åŠ›å€¤æ¤œè¨¼é–¢æ•°
        // =========================================
        function validateBasicInputs() {
            const weight = parseFloat(document.getElementById('weight').value);
            const days = parseInt(document.getElementById('days').value);
            const frequency = parseInt(document.getElementById('frequency').value);
            
            const errors = [];
            
            if (!weight || isNaN(weight) || weight <= 0 || weight > 500) {
                errors.push("âŒ ä½“é‡ã¯0ï½500kg ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„");
            }
            
            if (!days || isNaN(days) || days <= 0 || days > 365) {
                errors.push("âŒ æŠ•ä¸æ—¥æ•°ã¯1ï½365æ—¥ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„");
            }
            
            if (!frequency || isNaN(frequency) || frequency <= 0 || frequency > 10) {
                errors.push("âŒ 1æ—¥æŠ•ä¸å›æ•°ã¯1ï½10å›ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„");
            }
            
            if (errors.length > 0) {
                displayErrors(errors);
                return null;
            }
            
            return { weight, days, frequency };
        }

        // =========================================
        // Phase 1: ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºæ©Ÿèƒ½
        // =========================================
        function displayErrors(errors) {
            const alertsDiv = document.getElementById('globalAlerts');
            alertsDiv.innerHTML = errors.map(e => 
                `<div class="alert alert-danger">${e}</div>`
            ).join('');
        }

        // =========================================
        // Phase 1: æŠ•ä¸é‡ãƒã‚§ãƒƒã‚¯é–¢æ•°ï¼ˆåŒ»å­¦çš„å®‰å…¨ç¢ºèªï¼‰
        // =========================================
        function checkDosageSafety(drugName, dosage, weight, concentration) {
            const drug = DRUG_MASTER[drugName];
            if (!drug) return { safe: true, warnings: [], dangers: [] };

            const warnings = [];
            const dangers = [];

            // 1. æ¨å¥¨ç”¨é‡ç¯„å›²ã®ç¢ºèª
            if (dosage < drug.dosage_min) {
                warnings.push(`âš ï¸ æ¨å¥¨ç”¨é‡ã‚ˆã‚Šä½ã„: æ¨å¥¨ã¯ ${drug.dosage_min}ï½${drug.dosage_max} mg/kg ã§ã™`);
            }
            if (dosage > drug.dosage_max) {
                dangers.push(`ğŸš¨ æ¨å¥¨ç”¨é‡ã‚’è¶…ãˆã¦ã„ã¾ã™: æ¨å¥¨ã¯ ${drug.dosage_min}ï½${drug.dosage_max} mg/kg ã§ã™`);
            }

            // 2. 1å›ç”¨é‡ã®ç¢ºèª
            const singleDose = weight * dosage;
            if (singleDose > drug.max_total_per_dose) {
                dangers.push(`ğŸš¨ 1å›ç”¨é‡ãŒå¤šã™ãã¾ã™: æœ€å¤§ ${drug.max_total_per_dose}mg ã§ã™`);
            }

            // 3. ç¦å¿Œæƒ…å ±
            if (drug.contraindications && drug.contraindications.length > 0) {
                warnings.push(`âš ï¸ ç¦å¿Œæƒ…å ±: ${drug.contraindications.join(', ')}`);
            }

            // 4. ãã®ä»–ã®è­¦å‘Š
            if (drug.warnings) {
                warnings.push(...drug.warnings.map(w => `âš ï¸ ${w}`));
            }

            return {
                safe: dangers.length === 0,
                warnings,
                dangers
            };
        }

        // =========================================
        // Phase 1: è¨ˆç®—æ ¹æ‹ è¡¨ç¤ºé–¢æ•°
        // =========================================
        function generateCalculationBasis(drugName, weight, dosage, concentration, frequency, days) {
            const singleDose = weight * dosage;
            const singleVolume = singleDose / concentration;
            const dailyVolume = singleVolume * frequency;
            const totalVolume = dailyVolume * days;

            return `
                <div class="calculation-basis">
                    <h4>ğŸ“‹ ${drugName} - è¨ˆç®—æ ¹æ‹ </h4>
                    <p><strong>å…¥åŠ›å€¤:</strong></p>
                    <p>ãƒ»ä½“é‡: <span style="background: #fff3cd; padding: 2px 4px;">${weight} kg</span></p>
                    <p>ãƒ»ç”¨é‡: <span style="background: #fff3cd; padding: 2px 4px;">${dosage} mg/kg</span></p>
                    <p>ãƒ»æ¿ƒåº¦: <span style="background: #fff3cd; padding: 2px 4px;">${concentration} mg/mL</span></p>
                    <p>ãƒ»1æ—¥å›æ•°: <span style="background: #fff3cd; padding: 2px 4px;">${frequency} å›/æ—¥</span></p>
                    <p>ãƒ»æŠ•ä¸æœŸé–“: <span style="background: #fff3cd; padding: 2px 4px;">${days} æ—¥é–“</span></p>
                    <hr>
                    <p><strong>è¨ˆç®—éç¨‹:</strong></p>
                    <p>â‘  1å›ç”¨é‡ = ${weight} kg Ã— ${dosage} mg/kg = <strong style="font-size: 15px;">${singleDose.toFixed(2)} mg</strong></p>
                    <p>â‘¡ 1å›æŠ•ä¸é‡ = ${singleDose.toFixed(2)} mg Ã· ${concentration} mg/mL = <strong style="font-size: 15px;">${singleVolume.toFixed(3)} mL</strong></p>
                    <p>â‘¢ 1æ—¥ç·é‡ = ${singleVolume.toFixed(3)} mL Ã— ${frequency} å› = <strong style="font-size: 15px;">${dailyVolume.toFixed(3)} mL/æ—¥</strong></p>
                    <p>â‘£ ç·æŠ•ä¸é‡ = ${dailyVolume.toFixed(3)} mL/æ—¥ Ã— ${days} æ—¥ = <strong style="font-size: 15px; color: var(--primary);">${totalVolume.toFixed(3)} mL</strong></p>
                </div>
            `;
        }

        // =========================================
        // Phase 1: å…¨ä½“è¨ˆç®—å®Ÿè¡Œé–¢æ•°
        // =========================================
        function calculateAll() {
            const validated = validateBasicInputs();
            if (!validated) return;

            const { weight, days, frequency } = validated;
            const safetyDiv = document.getElementById('safetyAlerts');
            const resultDiv = document.getElementById('resultArea');

            let allWarnings = [];
            let allDangers = [];
            let resultHTML = '';
            let totalCost = 0;

            // å„è–¬å‰¤ã®è¨ˆç®—
            const drugRows = document.querySelectorAll('.drug-input-row');
            if (drugRows.length === 0) {
                resultDiv.innerHTML = '<div class="alert alert-warning">âš ï¸ è–¬å‰¤ã‚’1ç¨®ä»¥ä¸Šè¿½åŠ ã—ã¦ãã ã•ã„</div>';
                return;
            }

            resultHTML += `
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>è–¬å‰¤å</th>
                            <th>1å›ç”¨é‡</th>
                            <th>1å›æŠ•ä¸é‡</th>
                            <th>1æ—¥ç·é‡</th>
                            <th>ç·æŠ•ä¸é‡</th>
                            <th>è²»ç”¨</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            drugRows.forEach((row, index) => {
                const drugName = row.querySelector('input[id^="drugName"]')?.value || row.drugName;
                const dosage = parseFloat(row.querySelector('input[id^="drugDose"]')?.value || row.dosage);
                const concentration = parseFloat(row.querySelector('input[id^="drugConc"]')?.value || row.concentration || 250);
                const price = parseFloat(row.querySelector('input[id^="drugPrice"]')?.value || row.price);

                if (!drugName || !dosage || !concentration || !price) return;

                // å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯
                const safety = checkDosageSafety(drugName, dosage, weight, concentration);
                if (safety.dangers.length > 0) {
                    allDangers.push(...safety.dangers);
                }
                if (safety.warnings.length > 0) {
                    allWarnings.push(...safety.warnings);
                }

                // è¨ˆç®—
                const singleDose = weight * dosage;
                const singleVolume = singleDose / concentration;
                const dailyVolume = singleVolume * frequency;
                const totalVolume = dailyVolume * days;
                const cost = price * (dailyVolume * days);

                totalCost += cost;

                const safetyBadges = safety.dangers.length > 0 
                    ? '<span class="pill pills-danger">å±é™º</span>' 
                    : safety.warnings.length > 0 
                    ? '<span class="pill pills-warning">è­¦å‘Š</span>' 
                    : '<span class="pill" style="background: var(--success);">å®‰å…¨</span>';

                resultHTML += `
                    <tr>
                        <td>
                            <strong>${drugName}</strong><br>
                            ${safetyBadges}
                        </td>
                        <td>${singleDose.toFixed(2)} mg</td>
                        <td>${singleVolume.toFixed(3)} mL</td>
                        <td>${dailyVolume.toFixed(3)} mL</td>
                        <td>${totalVolume.toFixed(3)} mL</td>
                        <td>Â¥${cost.toFixed(0)}</td>
                    </tr>
                `;

                // è¨ˆç®—æ ¹æ‹ ã‚’è¿½åŠ 
                resultHTML += `
                    <tr>
                        <td colspan="6">
                            ${generateCalculationBasis(drugName, weight, dosage, concentration, frequency, days)}
                        </td>
                    </tr>
                `;
            });

            resultHTML += `
                    </tbody>
                </table>
                <div class="result-box" style="background: var(--primary); color: white; font-size: 18px; font-weight: bold;">
                    ğŸ’° ç·è²»ç”¨: Â¥${totalCost.toFixed(0)}
                </div>
                <button class="copy-btn" onclick="copyResults()">ğŸ“‹ çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
            `;

            resultDiv.innerHTML = resultHTML;

            // å®‰å…¨æ€§è­¦å‘Šè¡¨ç¤º
            let safetyHTML = '';
            if (allDangers.length > 0) {
                safetyHTML += `<div class="alert alert-danger"><strong>ğŸš¨ å±é™ºãªè¨­å®šãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ:</strong><br>${allDangers.join('<br>')}</div>`;
            }
            if (allWarnings.length > 0) {
                safetyHTML += `<div class="alert alert-warning"><strong>âš ï¸ è­¦å‘Š:</strong><br>${allWarnings.join('<br>')}</div>`;
            }
            if (allDangers.length === 0 && allWarnings.length === 0) {
                safetyHTML += `<div class="alert alert-success">âœ… ã™ã¹ã¦ã®ç”¨é‡ãŒå®‰å…¨ç¯„å›²ã§ã™</div>`;
            }
            safetyDiv.innerHTML = safetyHTML;
        }

        // =========================================
        // UIè£œåŠ©é–¢æ•°
        // =========================================
        function addNewDrugRow() {
            const container = document.getElementById('drugInput');
            const newRow = document.createElement('div');
            newRow.className = 'drug-input-row';
            newRow.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 0.5fr 0.7fr 0.8fr auto; gap: 8px; align-items: end; margin-top: 8px;">
                    <input type="text" placeholder="è–¬å‰¤å" autocomplete="off" list="drugList">
                    <input type="number" placeholder="ç”¨é‡" step="0.1">
                    <input type="text" placeholder="å˜ä½" value="mg/kg">
                    <input type="number" placeholder="ä¾¡æ ¼" step="1">
                    <button class="btn-small" onclick="this.parentElement.parentElement.remove()">âœ•</button>
                </div>
            `;
            container.appendChild(newRow);
        }

        function addDrugRow() {
            // enterã‚­ãƒ¼æŠ¼ä¸‹æ™‚ã®å‡¦ç†
        }

        function copyResults() {
            const resultArea = document.getElementById('resultArea');
            const text = resultArea.innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert('âœ… çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            });
        }

        // =========================================
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        // =========================================
        document.getElementById('weight').addEventListener('input', calculateAll);
        document.getElementById('days').addEventListener('input', calculateAll);
        document.getElementById('frequency').addEventListener('change', calculateAll);

        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½
        const dropZone = document.getElementById('dropZone');
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        dropZone.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                const file = files[0];
                const reader = new FileReader();
                reader.onload = function(event) {
                    // CSVèª­ã¿è¾¼ã¿å‡¦ç†
                    console.log('CSV loaded:', event.target.result);
                    alert('âœ… è–¬å‰¤CSVãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
                };
                reader.readAsText(file, 'UTF-8');
            }
        }

        // åˆæœŸåŒ–
        console.log('%cğŸ¥ vet-med-calc v6.7 - å®‰å…¨æ€§å¼·åŒ–ç‰ˆ ãƒ­ãƒ¼ãƒ‰å®Œäº†', 'color: green; font-size: 16px; font-weight: bold;');
    </script>
</body>
</html>
```

### **ã‚¹ãƒ†ãƒƒãƒ— 2: ãƒ•ã‚¡ã‚¤ãƒ«ç½®ãæ›ãˆ**

1. GitHub Web Editorã§ã€ç¾åœ¨ã®index.htmlã®å†…å®¹ã‚’ **å…¨å‰Šé™¤**
2. ä¸Šè¨˜ã®æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã‚’ **å…¨ä½“è²¼ã‚Šä»˜ã‘**
3. ç”»é¢ä¸‹ã®ã€ŒCommit changes...ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### **ã‚¹ãƒ†ãƒƒãƒ— 3: ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**
```
Title: ã€Phase 1å®Ÿè£…ã€‘å®‰å…¨æ€§å¼·åŒ–ç‰ˆv6.7 - æŠ•ä¸é‡ãƒã‚§ãƒƒã‚¯ãƒ»è¨ˆç®—æ ¹æ‹ è¡¨ç¤ºæ©Ÿèƒ½

Description:
- âœ… å…¥åŠ›å€¤æ¤œè¨¼æ©Ÿèƒ½ (ä½“é‡ãƒ»æ—¥æ•°ãƒ»å›æ•°ã®ç¯„å›²ç¢ºèª)
- âœ… æŠ•ä¸é‡ä¸Šé™ãƒã‚§ãƒƒã‚¯ (mg/kgã®æ¨å¥¨ç¯„å›²ãƒã‚§ãƒƒã‚¯)
- âœ… ç¦å¿Œæƒ…å ±è­¦å‘Šè¡¨ç¤º
- âœ… è¨ˆç®—å¼è¡¨ç¤ºæ©Ÿèƒ½ (å„ã‚¹ãƒ†ãƒƒãƒ—ã®è¨ˆç®—æ ¹æ‹ ã‚’è¡¨ç¤º)
- âœ… å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯ã‚¨ãƒªã‚¢ (å±é™ºãƒ»è­¦å‘Šãƒ»å®‰å…¨ã‚’è¡¨ç¤º)
- âœ… UIã®å¤§å¹…æ”¹å–„ (ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º)
```

---

## **å®Ÿè£…å¾Œã®å‹•ä½œ**

### **æ–°æ©Ÿèƒ½ 1ï¸âƒ£: æŠ•ä¸é‡ãƒã‚§ãƒƒã‚¯**
```
ä½“é‡: 5kg, ã‚¢ãƒ¢ã‚­ã‚·ã‚·ãƒªãƒ³ 30mg/kg å…¥åŠ›
â†’ âš ï¸ æ¨å¥¨ç”¨é‡ã‚’è¶…ãˆã¦ã„ã¾ã™: æ¨å¥¨ã¯ 15ï½25 mg/kg ã§ã™
```

### **æ–°æ©Ÿèƒ½ 2ï¸âƒ£: è¨ˆç®—æ ¹æ‹ è¡¨ç¤º**
```
ğŸ“‹ ã‚¢ãƒ¢ã‚­ã‚·ã‚·ãƒªãƒ³ - è¨ˆç®—æ ¹æ‹ 
å…¥åŠ›å€¤:
ãƒ»ä½“é‡: 5 kg
ãƒ»ç”¨é‡: 15 mg/kg
ãƒ»æ¿ƒåº¦: 250 mg/mL

è¨ˆç®—éç¨‹:
â‘  1å›ç”¨é‡ = 5 kg Ã— 15 mg/kg = 75 mg
â‘¡ 1å›æŠ•ä¸é‡ = 75 mg Ã· 250 mg/mL = 0.3 mL
â‘¢ 1æ—¥ç·é‡ = 0.3 mL Ã— 2 å› = 0.6 mL/æ—¥
â‘£ ç·æŠ•ä¸é‡ = 0.6 mL/æ—¥ Ã— 7 æ—¥ = 4.2 mL
```

### **æ–°æ©Ÿèƒ½ 3ï¸âƒ£: å®‰å…¨æ€§è­¦å‘Š**
```
âœ… ã™ã¹ã¦ã®ç”¨é‡ãŒå®‰å…¨ç¯„å›²ã§ã™
