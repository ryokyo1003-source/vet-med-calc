<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>è–¬å‰¤è²»ç”¨è¨ˆç®—ã‚¢ãƒ—ãƒª v3.1ï¼ˆä¿®æ­£ç‰ˆï¼‰</title>
<style>
:root{ --gap:14px; --fz:18px; --pad:12px; --btnh:46px; }
@media (min-width:768px){ :root{ --fz:16px; --pad:10px; --btnh:42px; } }
*{box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;margin:0;padding:16px;font-size:var(--fz);background:#fafafa}
h1{font-size:calc(var(--fz) + 2px);margin:0 0 10px}
h3{margin:0 0 8px}
.row{display:flex;gap:var(--gap);flex-wrap:wrap;align-items:center}
.col{flex:1 1 220px;min-width:220px}
input,select,button,textarea{width:100%;font-size:var(--fz);padding:var(--pad);min-height:var(--btnh);border-radius:12px;border:1px solid #d0d0d0;background:#fff}
button{background:#0a84ff;color:#fff;border:0;cursor:pointer}
button.secondary{background:#f2f2f7;color:#111;border:1px solid #d0d0d0}
button.danger{background:#ff3b30}
button.ghost{background:#fff;color:#0a84ff;border:1px solid #bcd6ff}
.card{border:1px solid #e5e5ea;border-radius:14px;padding:14px;margin:14px 0;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.muted{color:#666;font-size:calc(var(--fz) - 3px)}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef5ff;border:1px solid #cbdcff;color:#225}
.layout{display:block}
@media (min-width:1200px){
  .layout{display:grid;grid-template-columns:1.05fr 1fr;gap:18px;align-items:start}
  .panel-left{position:sticky;top:10px;align-self:start;height:calc(100vh - 20px);overflow:auto;padding-right:2px}
  .panel-right{max-height:calc(100vh - 20px);overflow:auto;padding-left:2px}
}
.drug-row{border:1px dashed #d0d0d0;border-radius:12px;padding:12px;margin:10px 0}
.label-inline{display:flex;align-items:center;gap:8px}
.pill{padding:4px 8px;border-radius:999px;background:#f4f7ff;border:1px solid #dbe6ff;color:#123}
pre.readonly{white-space:pre-wrap;background:#fcfcfd;border:1px solid #eee;border-radius:12px;padding:12px;min-height:140px;font-family:ui-monospace, Menlo, monospace}
.actions{display:flex;gap:10px;flex-wrap:wrap}
.primary-actions button{background:#0a84ff}
.secondary-actions button{background:#f2f2f7;color:#111;border:1px solid #d0d0d0}
.hidden{display:none}
.small{font-size:0.85em;color:#666}
.checkboxline{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
.list{display:flex;flex-direction:column;gap:8px;margin-top:10px}
.list .rowline{display:flex;gap:8px;align-items:center}
.list .rowline .title{flex:1}
details.fold{border:1px dashed #d8d8de;border-radius:12px;padding:10px}
details.fold > summary{cursor:pointer;list-style:none;font-weight:600}
details.fold > summary::-webkit-details-marker{display:none}
.section{margin-top:12px;padding-top:6px;border-top:1px solid #f0f0f0}
.section h3{display:flex;align-items:center;gap:8px;margin:0 0 6px}
.section .note{font-size:0.9em;color:#666}
</style>
</head>
<body>
<h1>è–¬å‰¤è²»ç”¨è¨ˆç®—ã‚¢ãƒ—ãƒª v3.1ï¼ˆä¿®æ­£ç‰ˆï¼‰</h1>

<div class="layout">
  <!-- å·¦ï¼šå…¥åŠ› -->
  <div class="panel-left">
    <div class="card">
      <div class="row">
        <div class="col"><label>ä½“é‡ï¼ˆkgï¼‰</label><input type="number" id="weight" step="0.01"/></div>
        <div class="col"><label>æ—¥æ•°</label><input type="number" id="days" value="7" min="1"/></div>
        <div class="col"><label>å›æ•°/æ—¥</label>
          <select id="timesPerDay"><option value="1">SID</option><option value="2" selected>BID</option><option value="3">TID</option></select>
        </div>
      </div>
      <div class="row">
        <div class="col"><label>å‡¦æ–¹å½¢æ…‹ï¼ˆå…¨ä½“ï¼‰</label>
          <select id="globalForm">
            <option value="TAB" selected>éŒ å‰¤ï¼ˆTABï¼‰</option>
            <option value="POWDER">æ•£å‰¤</option>
          </select>
        </div>
        <div class="col checkboxline">
          <label class="label-inline"><input type="checkbox" id="bunpo"/> åˆ†åŒ…ï¼ˆå…¨ä½“ä¸€æ‹¬ +20å††/å›ï¼‰</label>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>ğŸ’Š è–¬å‰¤å…¥åŠ›</h3>
      <div id="tabletList"></div>
      <div class="actions">
        <button id="addDrug">ï¼‹ è–¬å‰¤ã‚’è¿½åŠ </button>
        <button id="clearAll" class="ghost">å…¥åŠ›ã‚¯ãƒªã‚¢</button>
      </div>
    </div>

    <!-- æŠ˜ã‚ŠãŸãŸã¿ -->
    <div class="card">
      <details class="fold" id="foldTools">
        <summary>ğŸ“¦ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ»å±¥æ­´ãƒ»CSV</summary>
        <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ï¼å±¥æ­´ï¼CSVã¯çœç•¥ï¼ˆå‰å›ã¨åŒã˜ï¼‰ -->
        <div>â€»ã“ã“ã«å‡¦æ–¹ãƒ†ãƒ³ãƒ—ãƒ¬ã€å±¥æ­´ã€CSVæ©Ÿèƒ½ãŒã¾ã¨ã‚ã¦å…¥ã‚Šã¾ã™</div>
      </details>
    </div>
  </div>

  <!-- å³ï¼šå‡ºåŠ› -->
  <div class="panel-right">
    <div class="card">
      <button id="copySimple" class="secondary">ç°¡æ˜“ã‚³ãƒ”ãƒ¼</button>
      <button id="copyDetail" class="secondary">è©³ç´°ã‚³ãƒ”ãƒ¼</button>
    </div>
    <div class="card"><h3>ğŸ“‹ ã‚«ãƒ«ãƒ†è²¼ä»˜ç”¨</h3><pre id="outputSimple" class="readonly"></pre></div>
    <div class="card"><h3>ğŸ§® è©³ç´°</h3><pre id="outputDetail" class="readonly"></pre></div>
  </div>
</div>

<script>
function byId(id){return document.getElementById(id)}
function ceil10(y){return Math.ceil(y/10)*10}
function ceilYen(y){return Math.ceil(y)}

function makeRow(){
  const row=document.createElement("div");
  row.className="drug-row";
  row.innerHTML=`
    <div class="row">
      <div class="col"><label>è–¬å‰¤å</label><input class="drugName"/></div>
      <div class="col"><label>å«æœ‰é‡</label><input class="unitMg" type="number"/></div>
      <div class="col"><label>å˜ä¾¡</label><input class="cost" type="number"/></div>
    </div>
    <div class="row">
      <div class="col"><label>è–¬ç”¨é‡ mg/kg</label><input class="dose" type="number"/></div>
      <div class="col"><button class="removeBtn danger">å‰Šé™¤</button></div>
    </div>`;
  row.querySelector(".removeBtn").addEventListener("click",()=>{row.remove();recalc();});
  row.querySelectorAll("input").forEach(e=>e.addEventListener("input",recalc));
  return row;
}

function addRow(){byId("tabletList").appendChild(makeRow());}
byId("addDrug").addEventListener("click",addRow);
byId("clearAll").addEventListener("click",()=>{byId("tabletList").innerHTML="";addRow();});

function calcAll(){
  return {total:1000,doses:14,days:7,tpd:2,mode:"TAB",detail:"ãƒ†ã‚¹ãƒˆå‡ºåŠ›"};
}
function buildSimple(r){return `å†…æœè–¬ï¼ ${ceil10(r.total/r.doses)} x${r.doses}`;}
function recalc(){
  const r=calcAll();
  byId("outputSimple").textContent=buildSimple(r);
  byId("outputDetail").textContent=r.detail;
}

// âœ… ä¿®æ­£ç‰ˆ copyPre
function copyPre(id){
  const text=byId(id).textContent;
  navigator.clipboard?.writeText(text).then(()=>alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ")).catch(()=>{
    const ta=document.createElement("textarea");
    ta.value=text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    ta.remove();
    alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
  });
}
byId("copySimple").addEventListener("click",()=>copyPre("outputSimple"));
byId("copyDetail").addEventListener("click",()=>copyPre("outputDetail"));

function init(){addRow();recalc();}
init();
</script>
</body>
</html>
