<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>è–¬å‰¤è²»ç”¨è¨ˆç®—ã‚¢ãƒ—ãƒª v3.0 (è‡ªå‹•è¨ˆç®—å¯¾å¿œ)</title>
<style>
:root{ --gap:14px; --fz:18px; --pad:14px; --btnh:50px; }
@media (min-width:768px){ :root{ --fz:16px; --pad:10px; --btnh:44px; } }
*{box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;margin:0;padding:16px;font-size:var(--fz);-webkit-text-size-adjust:100%;background:#fafafa}
h1{font-size:calc(var(--fz) + 2px);margin:0 0 8px 0}
.row{display:flex;gap:var(--gap);flex-wrap:wrap;align-items:center}
.col{flex:1 1 120px;min-width:120px}
.col-full{flex:1 1 100%}
input,select,button,textarea{width:100%;font-size:var(--fz);padding:var(--pad);min-height:var(--btnh);border-radius:12px;border:1px solid #d0d0d0;background:#fff}
button{background:#0a84ff;color:#fff;border:0;cursor:pointer;font-weight:bold}
button:active{opacity:.8}
button.secondary{background:#e5e5ea;color:#111;border:0}
button.danger{background:#ff3b30}
textarea{height:180px;line-height:1.6}
.card{border:1px solid #e5e5ea;border-radius:14px;padding:14px;margin:14px 0;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.muted{color:#666;font-size:calc(var(--fz) - 3px)}
.tabs{display:flex;gap:8px;margin-bottom:8px}
.tab{padding:10px 14px;border:1px solid #d0d0d0;border-radius:999px;background:#f2f2f7;cursor:pointer;user-select:none}
.tab.active{background:#e7f1ff;border-color:#7aa7ff;font-weight:bold}
.section{display:none}.section.active{display:block}
.drug-row{border:1px dashed #d0d0d0;border-radius:12px;padding:12px;margin:10px 0;background:#fafafa}
.dropdown{position:relative}
.suggest{position:absolute;top:100%;left:0;right:0;z-index:5;background:#fff;border:1px solid #d0d0d0;border-radius:10px;margin-top:6px;max-height:260px;overflow:auto;box-shadow:0 8px 20px rgba(0,0,0,.08)}
.suggest div{padding:12px;cursor:pointer}
.suggest div:hover,.suggest div.selected{background:#eef5ff}
.switch{display:flex;align-items:center;gap:10px;user-select:none}
kbd{background:#f2f2f7;border:1px solid #d0d0d0;border-radius:6px;padding:2px 6px}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef5ff;border:1px solid #cbdcff;color:#225;font-size:calc(var(--fz) - 4px)}
.layout{display:block}
@media (min-width:1000px){
  .layout{display:grid;grid-template-columns:1.1fr 1fr;gap:18px;align-items:start}
  .panel-left{position:sticky;top:10px;align-self:start;max-height:calc(100vh - 20px);overflow:auto;padding-right:8px}
  .panel-right{max-height:calc(100vh - 20px);overflow:auto;padding-left:8px}
}
.panel-right textarea{height:220px}
.remove-btn{min-width:40px;max-width:40px;flex:0;padding:0;background:#ffebee;color:#c62828}
input:read-only{background:#f2f2f7;opacity:.8}
#copy-feedback{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.7);color:white;padding:10px 20px;border-radius:10px;z-index:100;opacity:0;transition:opacity .3s;pointer-events:none}
#copy-feedback.show{opacity:1}
</style>
</head>
<body>
<h1>è–¬å‰¤è²»ç”¨è¨ˆç®—ã‚¢ãƒ—ãƒª v3.0 (è‡ªå‹•è¨ˆç®—å¯¾å¿œ)</h1>
<div class="layout">
  <div class="panel-left">
    <div class="card">
      <div class="row">
        <div class="col"><label>ä½“é‡ (kg)</label><input type="number" id="weight" step="0.01" inputmode="decimal"/></div>
        <div class="col"><label>æ—¥æ•°</label><input type="number" id="days" value="7" min="1" inputmode="numeric"/></div>
        <div class="col"><label>å›æ•°/æ—¥</label>
          <select id="timesPerDay"><option value="1">SID (1å›)</option><option value="2" selected>BID (2å›)</option><option value="3">TID (3å›)</option></select>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <div class="col switch"><input type="checkbox" id="bunpo"/><label for="bunpo">åˆ†åŒ…æ©Ÿä½¿ç”¨ (+20å††/å›)</label></div>
        <div class="col muted">å…¥åŠ›ã¯è‡ªå‹•ã§ä¿å­˜ã•ã‚Œã¾ã™</div>
      </div>
    </div>

    <div class="card">
      <div class="tabs">
        <div class="tab active" data-target="tab-tabl">éŒ å‰¤ãƒ»ã‚«ãƒ—ã‚»ãƒ«</div>
        <div class="tab" data-target="tab-syrp">ã‚·ãƒ­ãƒƒãƒ—ãƒ»ç²‰è–¬</div>
      </div>
      <div id="tab-tabl" class="section active">
        <div id="tabletList"></div>
        <button id="addTablet" class="secondary">ï¼‹ éŒ å‰¤ã‚’è¿½åŠ </button>
      </div>
      <div id="tab-syrp" class="section">
        <div id="syrupList"></div>
        <div class="row" style="margin-top:10px">
          <div class="col switch"><input type="checkbox" id="syrupDissolve"/><label for="syrupDissolve">ã‚·ãƒ­ãƒƒãƒ—ã«æº¶ã‹ã™ (+500å††)</label></div>
        </div>
        <button id="addSyrup" class="secondary">ï¼‹ ç²‰è–¬ã‚’è¿½åŠ </button>
      </div>
    </div>

    <div class="card">
      <h3>ğŸ“¦ è–¬å‰¤ãƒ‡ãƒ¼ã‚¿ (CSV)</h3>
      <p class="muted" style="margin: -8px 0 8px 0;">ãƒ˜ãƒƒãƒ€è¡Œ: <code>åç§°,ä¾¡æ ¼,å˜ä½,ç”¨é‡,è¦æ ¼</code><br/>ä¾‹: ã‚»ãƒ•ã‚¡ã‚¯ãƒªã‚¢éŒ ,25.5,éŒ ,15,250</p>
      <div class="row">
        <div class="col col-full"><input type="file" id="csvInput" accept=".csv"/></div>
        <div class="col"><button id="saveCsv" class="secondary">ç¾åœ¨ã®è–¬å‰¤ã‚’CSVä¿å­˜</button></div>
        <div class="col"><button id="clearCsv" class="danger">ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤</button></div>
      </div>
    </div>
  </div>

  <div class="panel-right">
    <div class="card">
      <div class="row" style="gap:10px">
        <div class="col"><button id="copySimple">ç°¡æ˜“ã‚³ãƒ”ãƒ¼</button></div>
        <div class="col"><button id="copyDetail">è©³ç´°ã‚³ãƒ”ãƒ¼</button></div>
        <div class="col"><button id="clearBtn" class="secondary">å…¨ãƒªã‚»ãƒƒãƒˆ</button></div>
      </div>
    </div>
    <div class="card">
      <h3>ğŸ“‹ ã‚«ãƒ«ãƒ†è²¼ä»˜ç”¨ (ç°¡æ˜“)</h3>
      <textarea id="outputSimple" readonly></textarea>
    </div>
    <div class="card">
      <h3>ğŸ§® è¨ˆç®—æ ¹æ‹  (è©³ç´°)</h3>
      <textarea id="outputDetail" readonly></textarea>
    </div>
  </div>
</div>

<div id="copy-feedback">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // --- DOMè¦ç´ ã®å–å¾— ---
  const weightEl = document.getElementById('weight');
  const daysEl = document.getElementById('days');
  const timesPerDayEl = document.getElementById('timesPerDay');
  const bunpoEl = document.getElementById('bunpo');
  const syrupDissolveEl = document.getElementById('syrupDissolve');
  const tabletListEl = document.getElementById('tabletList');
  const syrupListEl = document.getElementById('syrupList');
  const outputSimpleEl = document.getElementById('outputSimple');
  const outputDetailEl = document.getElementById('outputDetail');
  
  // è–¬å‰¤ãƒ‡ãƒ¼ã‚¿ (ã‚°ãƒ­ãƒ¼ãƒãƒ«)
  let drugMaster = [];
  let activeSuggestionInput = null;

  // --- ä¸»è¦æ©Ÿèƒ½ ---

  // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—ã®ãƒˆãƒªã‚¬ãƒ¼
  const setupEventListeners = () => {
    document.querySelector('.layout').addEventListener('input', handleFormChange);
    document.querySelector('.layout').addEventListener('change', handleFormChange); // for checkboxes and selects

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab, .section').forEach(el => el.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.target).classList.add('active');
      });
    });

    // è–¬å‰¤è¿½åŠ ãƒœã‚¿ãƒ³
    document.getElementById('addTablet').addEventListener('click', () => addDrugRow('tablet'));
    document.getElementById('addSyrup').addEventListener('click', () => addDrugRow('syrup'));
    
    // å…¨ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
    document.getElementById('clearBtn').addEventListener('click', resetAll);

    // ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³
    document.getElementById('copySimple').addEventListener('click', () => copyToClipboard(outputSimpleEl.value, 'ç°¡æ˜“'));
    document.getElementById('copyDetail').addEventListener('click', () => copyToClipboard(outputDetailEl.value, 'è©³ç´°'));

    // CSVé–¢é€£
    document.getElementById('csvInput').addEventListener('change', handleCsvUpload);
    document.getElementById('saveCsv').addEventListener('click', saveCurrentDrugsToCsv);
    document.getElementById('clearCsv').addEventListener('click', clearDrugMaster);

    // ã‚µã‚¸ã‚§ã‚¹ãƒˆæ©Ÿèƒ½ã®ãŸã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ
    document.body.addEventListener('focusin', handleFocusIn);
    document.body.addEventListener('click', () => hideSuggestions());
  };

  const handleFormChange = (e) => {
    calculateAndRender();
    saveInputsToLocalStorage();
  };

  // --- è¨ˆç®—ã¨æç”» ---
  const calculateAndRender = () => {
    const weight = parseFloat(weightEl.value) || 0;
    const days = parseInt(daysEl.value) || 0;
    const timesPerDay = parseInt(timesPerDayEl.value) || 0;
    const useBunpo = bunpoEl.checked;
    const useSyrupDissolve = syrupDissolveEl.checked;
    
    let simpleOutput = '';
    let detailOutput = 'ã€è–¬å‰¤è¨ˆç®—è©³ç´°ã€‘\n';
    let totalCost = 0;
    const drugLines = [];

    // éŒ å‰¤ã¨ç²‰è–¬ã‚’ã¾ã¨ã‚ã¦å‡¦ç†
    document.querySelectorAll('.drug-row').forEach(row => {
      const drug = parseDrugRow(row, weight);
      if (!drug.name) return;

      const totalAmount = drug.amount * timesPerDay * days;
      const drugCost = Math.round(totalAmount * drug.price);
      totalCost += drugCost;
      
      const unit = row.dataset.type === 'syrup' ? 'g' : 'éŒ ';
      drugLines.push({ ...drug, totalAmount, drugCost, unit });
    });

    drugLines.forEach(d => {
      simpleOutput += `${d.name} ${d.amount}${d.unit} x ${timesPerDay}å›/æ—¥ ${days}æ—¥åˆ†\n`;
      detailOutput += `ãƒ»${d.name} (${d.price.toLocaleString()}å††/${d.unit})\n`;
      detailOutput += `  1å›é‡: ${d.amount.toFixed(2)}${d.unit} x ${timesPerDay}å› x ${days}æ—¥ = ${d.totalAmount.toFixed(2)}${d.unit}\n`;
      if (d.auto) {
        detailOutput += `  (è‡ªå‹•è¨ˆç®—: ${weight}kg * ${d.dose}mg/kg Ã· ${d.strength}mg/${d.unit} = ${d.amount.toFixed(2)}${d.unit})\n`;
      }
      detailOutput += `  å°è¨ˆ: ${d.drugCost.toLocaleString()}å††\n`;
    });
    
    detailOutput += '\nã€è¿½åŠ è²»ç”¨ã€‘\n';
    let bunpoCost = 0;
    if (useBunpo) {
      bunpoCost = 20 * timesPerDay * days;
      totalCost += bunpoCost;
      simpleOutput += `åˆ†åŒ…\n`;
      detailOutput += `ãƒ»åˆ†åŒ…æ©Ÿä½¿ç”¨: 20å†† x ${timesPerDay}å› x ${days}æ—¥ = ${bunpoCost.toLocaleString()}å††\n`;
    }
    
    let syrupDissolveCost = 0;
    if (useSyrupDissolve && document.querySelector('#syrupList .drug-row')) {
      syrupDissolveCost = 500;
      totalCost += syrupDissolveCost;
      simpleOutput += `ã‚·ãƒ­ãƒƒãƒ—æ··åˆ\n`;
      detailOutput += `ãƒ»ã‚·ãƒ­ãƒƒãƒ—æ··åˆ: ${syrupDissolveCost.toLocaleString()}å††\n`;
    }
    
    simpleOutput += `\nåˆè¨ˆ: ${Math.round(totalCost).toLocaleString()} å††`;
    detailOutput += `\n----------------\n`;
    detailOutput += `åˆè¨ˆé‡‘é¡: ${Math.round(totalCost).toLocaleString()} å††`;

    outputSimpleEl.value = simpleOutput;
    outputDetailEl.value = detailOutput;
  };

  const parseDrugRow = (row, weight) => {
    const name = row.querySelector('.drug-name').value;
    const price = parseFloat(row.querySelector('.drug-price').value) || 0;
    const dose = parseFloat(row.querySelector('.drug-dose').value) || 0;
    const strength = parseFloat(row.querySelector('.drug-strength').value) || 0;
    const amountInput = row.querySelector('.drug-amount');
    const autoCalc = !amountInput.readOnly;
    
    let amount = parseFloat(amountInput.value) || 0;

    // è‡ªå‹•è¨ˆç®—
    if (autoCalc && weight > 0 && dose > 0 && strength > 0) {
      const calculatedAmount = (weight * dose) / strength;
      // éŒ å‰¤ã¯0.25å˜ä½ã§ä¸¸ã‚ã‚‹ã€ç²‰è–¬ã¯å°æ•°ç‚¹ç¬¬2ä½ã¾ã§
      const rounding = row.dataset.type === 'tablet' ? 0.25 : 0.01;
      amount = Math.round(calculatedAmount / rounding) * rounding;
      amountInput.value = amount.toFixed(2);
    }
    
    return { name, price, dose, strength, amount, auto: autoCalc };
  };

  // --- è–¬å‰¤è¡Œã®ç®¡ç† ---
  const addDrugRow = (type) => {
    const listEl = type === 'tablet' ? tabletListEl : syrupListEl;
    const id = Date.now();
    const unit = type === 'syrup' ? 'g' : 'éŒ ';
    const rowHtml = `
      <div class="drug-row" id="row-${id}" data-type="${type}">
        <div class="row">
          <div class="col col-full dropdown">
            <input type="text" class="drug-name" placeholder="è–¬å‰¤å (å€™è£œã‹ã‚‰é¸æŠ)">
            <div class="suggest"></div>
          </div>
        </div>
        <div class="row" style="margin-top:var(--gap)">
          <div class="col"><label>ä¾¡æ ¼/${unit}</label><input type="number" class="drug-price" inputmode="decimal"></div>
          <div class="col"><label>ç”¨é‡(mg/kg)</label><input type="number" class="drug-dose" inputmode="decimal"></div>
          <div class="col"><label>è¦æ ¼(mg/${unit})</label><input type="number" class="drug-strength" inputmode="decimal"></div>
        </div>
        <div class="row" style="margin-top:var(--gap)">
          <div class="col"><label>1å›é‡(${unit}) <span class="badge">è‡ªå‹•è¨ˆç®—</span></label><input type="number" class="drug-amount" inputmode="decimal" value="0.00"></div>
          <button class="remove-btn" onclick="document.getElementById('row-${id}').remove(); calculateAndRender();">Ã—</button>
        </div>
      </div>
    `;
    listEl.insertAdjacentHTML('beforeend', rowHtml);
  };
  
  // --- ã‚µã‚¸ã‚§ã‚¹ãƒˆæ©Ÿèƒ½ ---
  const handleFocusIn = (e) => {
    if (e.target.classList.contains('drug-name')) {
      activeSuggestionInput = e.target;
      e.target.addEventListener('keyup', showSuggestions);
      e.target.addEventListener('input', showSuggestions);
    } else {
      hideSuggestions();
    }
  };

  const showSuggestions = (e) => {
    const input = e.target;
    const keyword = input.value.toLowerCase();
    const suggestBox = input.nextElementSibling;
    
    if (!suggestBox || !suggestBox.classList.contains('suggest')) return;
    
    suggestBox.innerHTML = '';
    if (keyword.length === 0) {
      hideSuggestions();
      return;
    }
    
    const filteredDrugs = drugMaster.filter(d => d.name.toLowerCase().includes(keyword));
    
    if (filteredDrugs.length > 0) {
      filteredDrugs.forEach(drug => {
        const div = document.createElement('div');
        div.textContent = `${drug.name} (${drug.price}å††/${drug.unit})`;
        div.addEventListener('click', () => {
          selectSuggestion(drug, input.closest('.drug-row'));
        });
        suggestBox.appendChild(div);
      });
      suggestBox.style.display = 'block';
    } else {
      hideSuggestions();
    }
  };

  const selectSuggestion = (drug, row) => {
    row.querySelector('.drug-name').value = drug.name;
    row.querySelector('.drug-price').value = drug.price;
    row.querySelector('.drug-dose').value = drug.dose;
    row.querySelector('.drug-strength').value = drug.strength;
    hideSuggestions();
    calculateAndRender();
    saveInputsToLocalStorage();
  };

  const hideSuggestions = () => {
    const allSuggests = document.querySelectorAll('.suggest');
    allSuggests.forEach(s => { s.style.display = 'none'; });
  };


  // --- ãƒ‡ãƒ¼ã‚¿ç®¡ç† (CSV & LocalStorage) ---
  const handleCsvUpload = (event) => {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      const text = e.target.result;
      const lines = text.split('\n').filter(line => line.trim() !== '');
      const header = lines.shift().split(',').map(h => h.trim());
      
      drugMaster = lines.map(line => {
        const values = line.split(',');
        return {
          name: values[0]?.trim() || '',
          price: parseFloat(values[1]) || 0,
          unit: values[2]?.trim() || 'éŒ ',
          dose: parseFloat(values[3]) || 0,
          strength: parseFloat(values[4]) || 0,
        };
      }).filter(d => d.name);
      
      saveDrugMasterToLocalStorage();
      alert(`${drugMaster.length}ä»¶ã®è–¬å‰¤ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã—ã¾ã—ãŸã€‚`);
    };
    reader.readAsText(file);
  };
  
  const saveCurrentDrugsToCsv = () => {
    let csvContent = "data:text/csv;charset=utf-8,åç§°,ä¾¡æ ¼,å˜ä½,ç”¨é‡,è¦æ ¼\n";
    const currentDrugs = new Map(); // é‡è¤‡ã‚’é¿ã‘ã‚‹

    document.querySelectorAll('.drug-row').forEach(row => {
      const name = row.querySelector('.drug-name').value;
      if (!name) return;
      
      const price = row.querySelector('.drug-price').value;
      const dose = row.querySelector('.drug-dose').value;
      const strength = row.querySelector('.drug-strength').value;
      const type = row.dataset.type;
      const unit = type === 'syrup' ? 'g' : 'éŒ ';
      
      if (!currentDrugs.has(name)) {
        currentDrugs.set(name, `${name},${price},${unit},${dose},${strength}`);
      }
    });

    if (currentDrugs.size === 0) {
        alert('ä¿å­˜ã™ã‚‹è–¬å‰¤ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
    }

    currentDrugs.forEach(line => {
        csvContent += line + "\n";
    });

    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "yakuzai_data.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  };

  const saveDrugMasterToLocalStorage = () => {
    localStorage.setItem('drugMasterData', JSON.stringify(drugMaster));
  };

  const loadDrugMasterFromLocalStorage = () => {
    const data = localStorage.getItem('drugMasterData');
    if (data) {
      drugMaster = JSON.parse(data);
    }
  };
  
  const clearDrugMaster = () => {
    if (confirm('ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å…¨ã¦ã®è–¬å‰¤ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
        localStorage.removeItem('drugMasterData');
        drugMaster = [];
        alert('è–¬å‰¤ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
    }
  };

  const saveInputsToLocalStorage = () => {
    const inputs = {
      weight: weightEl.value,
      days: daysEl.value,
      timesPerDay: timesPerDayEl.value,
      bunpo: bunpoEl.checked,
      syrupDissolve: syrupDissolveEl.checked,
    };
    localStorage.setItem('appInputs', JSON.stringify(inputs));
  };
  
  const loadInputsFromLocalStorage = () => {
    const data = localStorage.getItem('appInputs');
    if (data) {
      const inputs = JSON.parse(data);
      weightEl.value = inputs.weight || '';
      daysEl.value = inputs.days || '7';
      timesPerDayEl.value = inputs.timesPerDay || '2';
      bunpoEl.checked = inputs.bunpo || false;
      syrupDissolveEl.checked = inputs.syrupDissolve || false;
    }
  };
  
  const resetAll = () => {
    if (confirm('å…¨ã¦ã®å…¥åŠ›å†…å®¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ (ä¿å­˜ã•ã‚ŒãŸè–¬å‰¤ãƒ‡ãƒ¼ã‚¿ã¯æ¶ˆãˆã¾ã›ã‚“)')) {
        document.querySelectorAll('input[type="number"], input[type="text"]').forEach(i => i.value = '');
        document.querySelectorAll('input[type="checkbox"]').forEach(i => i.checked = false);
        daysEl.value = '7';
        timesPerDayEl.value = '2';
        tabletListEl.innerHTML = '';
        syrupListEl.innerHTML = '';
        calculateAndRender();
        saveInputsToLocalStorage();
    }
  };

  // --- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ---
  const copyToClipboard = (text, type) => {
    navigator.clipboard.writeText(text).then(() => {
      const feedbackEl = document.getElementById('copy-feedback');
      feedbackEl.textContent = `${type}ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼`;
      feedbackEl.classList.add('show');
      setTimeout(() => feedbackEl.classList.remove('show'), 2000);
    }).catch(err => {
      console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', err);
    });
  };

  // --- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ– ---
  loadDrugMasterFromLocalStorage();
  loadInputsFromLocalStorage();
  setupEventListeners();
  calculateAndRender();
});
</script>
</body>
</html>
