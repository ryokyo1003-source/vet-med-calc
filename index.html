<!-- ğŸ”§ index.html å…¨ä½“ï¼šæ©Ÿèƒ½è¿½åŠ æ¸ˆ -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è–¬å‰¤è¨ˆç®—ã‚¢ãƒ—ãƒª</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    label, input, button { display: block; margin: 0.5em 0; }
    input { padding: 0.5em; width: 100%; max-width: 300px; }
    button { padding: 0.5em 1em; font-size: 1em; }
    #doseBreakdown { margin-top: 1em; font-weight: bold; }
    #actualDosePerKg { margin-top: 0.5em; color: #555; }
  </style>
</head>
<body>
  <h1>è–¬å‰¤è‡ªå‹•è¨ˆç®—ãƒ„ãƒ¼ãƒ«</h1>

  <label>è–¬å‰¤åï¼ˆä¾‹ï¼šã‚»ãƒ•ã‚¡ã‚¯ãƒªã‚¢ï¼‰<input id="drugName" /></label>
  <label>ä½“é‡ï¼ˆkgï¼‰<input type="number" id="weight" /></label>
  <label>å¿…è¦é‡ï¼ˆmgï¼‰<input type="number" id="requiredMg" /></label>
  <label>ä½¿ç”¨å¯èƒ½ãªéŒ å‰¤å«æœ‰é‡ï¼ˆmgï¼‰â€»ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š<input id="tabletOptions" placeholder="600,300,75" /></label>

  <button onclick="onCalculate()">è¨ˆç®—ã™ã‚‹</button>

  <div id="doseBreakdown"></div>
  <div id="actualDosePerKg"></div>

  <script>
    function calculateDoseCombination(totalMgRequired, tabletOptionsMg) {
      tabletOptionsMg.sort((a, b) => b - a);
      const result = [];
      let remaining = totalMgRequired;

      for (let dose of tabletOptionsMg) {
        let count = Math.floor(remaining / dose);
        if (count > 0) {
          result.push({ dose, count });
          remaining -= dose * count;
        }
      }

      // 1/2éŒ , 1/4éŒ ã§æ®‹ã‚Šã‚’è£œå®Œ
      for (let frac of [0.5, 0.25]) {
        for (let dose of tabletOptionsMg) {
          let partial = dose * frac;
          if (remaining >= partial - 0.1) {
            result.push({ dose, count: frac });
            remaining -= partial;
            break;
          }
        }
      }

      return { result, overMg: totalMgRequired - remaining };
    }

    function displayDoseBreakdown(drugName, bodyWeightKg, totalRequiredMg, availableTabletsMg) {
      const { result, overMg } = calculateDoseCombination(totalRequiredMg, availableTabletsMg);

      const breakdownEl = document.getElementById('doseBreakdown');
      const actualDoseEl = document.getElementById('actualDosePerKg');

      let html = `<div>${drugName}</div>`;
      let totalActualMg = 0;

      result.forEach(({ dose, count }) => {
        let label = (count === 0.5) ? '1/2éŒ ' : (count === 0.25) ? '1/4éŒ ' : `${count}éŒ `;
        html += `<div> - ${dose}mg Ã— ${label}</div>`;
        totalActualMg += dose * count;
      });

      const overPct = ((totalActualMg - totalRequiredMg) / totalRequiredMg * 100).toFixed(2);
      html += `<div> â†’ åˆè¨ˆ ${totalActualMg.toFixed(1)}mgï¼ˆ+${overPct}%ï¼‰</div>`;

      const actualPerKg = (totalActualMg / bodyWeightKg).toFixed(2);
      actualDoseEl.innerText = `å®Ÿéš›ã®æŠ•ä¸é‡ï¼š${actualPerKg} mg/kg`;

      breakdownEl.innerHTML = html;
    }

    function onCalculate() {
      const name = document.getElementById('drugName').value;
      const weight = parseFloat(document.getElementById('weight').value);
      const requiredMg = parseFloat(document.getElementById('requiredMg').value);
      const tabletStr = document.getElementById('tabletOptions').value;
      const tabletOptions = tabletStr.split(',').map(s => parseFloat(s.trim())).filter(n => !isNaN(n));

      if (!name || !weight || !requiredMg || tabletOptions.length === 0) {
        alert('ã™ã¹ã¦ã®é …ç›®ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      displayDoseBreakdown(name, weight, requiredMg, tabletOptions);
    }
  </script>
</body>
</html>
